<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Maschinen-Check</title>
<style>
  :root{
    --bg:#0f1115; --panel:#151923; --text:#ffffff; --muted:#9aa1b3;
    --green:#15803d; --blue:#1e3a8a; --orange:#f97316; --red:#b91c1c;
    --btn:#19c37d; --btn2:#4b5563; --border:#232838;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial}
  header{background:#151923;border-bottom:1px solid var(--border);padding:12px;position:sticky;top:0;z-index:10}
  h1{margin:0 0 4px 0;font-size:18px}
  .total{color:var(--muted);font-size:13px}
  main{padding:12px;max-width:820px;margin:0 auto}

  .btn{width:100%;padding:10px;border:none;border-radius:8px;background:var(--btn);color:white;font-weight:600;cursor:pointer}
  .list{margin-top:10px}
  .task{padding:12px;border-radius:10px;margin-bottom:10px;border:1px solid var(--border)}
  .task.red{background:var(--red)}
  .task.orange{background:var(--orange)}
  .task.blue{background:var(--blue)}
  .task.green{background:var(--green)}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center;flex-wrap:wrap}
  .note{color:#eef;opacity:.9}
  .pill{padding:4px 10px;border-radius:999px;background:rgba(0,0,0,.25);font-variant-numeric:tabular-nums;font-weight:700}
  .small{font-size:12px;color:#e8e8e8;opacity:.85}
  .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
  .tag{background:rgba(0,0,0,.25);padding:2px 8px;border-radius:999px;font-size:12px}
  .actions{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .btn2{background:var(--btn2);color:white;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-size:12px}
  .danger{background:#7f1d1d}
  input:not([type="checkbox"]){
    width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);
    background:#0e1420;color:#e9ecf1
  }
  dialog{border:none;border-radius:12px;padding:0;max-width:560px;width:92%}
  .dlg{padding:14px;background:#151923;color:#fff;border:1px solid var(--border);border-radius:12px}
  .dlg h3{margin:0 0 8px 0}
  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:620px){ .grid{grid-template-columns:1fr 1fr} }
  .checks{display:flex;gap:8px;flex-wrap:wrap}
  .checks label{display:flex;align-items:center;gap:8px;font-size:12px;padding:6px 10px;border-radius:999px;
    border:1px solid var(--border); background:#0e1420; color:#e9ecf1}
  .checks input[type="checkbox"]{width:auto;height:auto;margin:0;transform:scale(1.2);accent-color:#19c37d;}
  .calcRow{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px;margin-top:4px}
  .infoBox{margin-top:10px;padding:8px;background:#222;border-radius:6px;font-size:13px;color:#ccc}
</style>
</head>
<body>
<header>
  <h1>Maschinen-Check</h1>
  <div id="shiftInfo" class="total"></div>
  <div class="total" id="totalTime">Gesamtzeit: 0 Min (offen)</div>
  <div id="pauseInfo" class="total"></div>
</header>

<main>
  <button class="btn" id="addBtn">+ Maschine hinzuf√ºgen</button>
  <div class="list" id="taskList"></div>

  <div class="infoBox">
    <h3>Fachung-Wechsel Zeit messen</h3>
    <div id="stopwatch">00:00</div>
    <button class="btn2" onclick="startStopwatch()">Start</button>
    <button class="btn2" onclick="stopStopwatch()">Stop</button>
    <button class="btn2" onclick="resetStopwatch()">Reset</button>
    <div id="lastTime"></div>
    <div id="avgTime"></div>
  </div>

  <button class="btn" style="margin-top:15px" onclick="exportPDF()">üìÑ PDF erstellen</button>
</main>

<!-- Dialog -->
<dialog id="taskDlg"> ... (dein kompletter urspr√ºnglicher Dialog bleibt hier unver√§ndert) ... </dialog>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
/* dein kompletter urspr√ºnglicher JS-Code hier ... */
/* ich f√ºge nur unten die NEUEN FUNKTIONEN hinzu */

/* === Schicht-Erkennung === */
function detectShift(){
  const now = new Date();
  const minutes = now.getHours()*60 + now.getMinutes();
  let shift = "";
  if(minutes >= 330 && minutes < 810) shift = "Fr√ºhschicht (05:30 - 13:30)";
  else if(minutes >= 810 && minutes < 1290) shift = "Sp√§tschicht (13:30 - 21:30)";
  else shift = "Nachtschicht (21:30 - 05:30)";
  document.getElementById("shiftInfo").textContent = "Aktuelle Schicht: " + shift;
}

/* === Pause-Info === */
function updatePauseInfo(){
  if(tasks.length === 0){ document.getElementById("pauseInfo").textContent = ""; return; }
  const now = Date.now();
  const nextDue = Math.min(...tasks.filter(t=>!t.done).map(t=>t.due));
  const minsLeft = Math.floor((nextDue - now) / 60000);
  const elapsed = Math.floor((now - shiftStartTime()) / 60000);
  const minsToCheck = 120 - (elapsed % 120);
  const msg = `Pause m√∂glich: ${minsLeft} Min${minsToCheck <= minsLeft ? ` (Sichtpr√ºfung in ${minsToCheck} Min)` : ""}`;
  document.getElementById("pauseInfo").textContent = msg;
}
function shiftStartTime(){
  const now = new Date();
  let start = new Date(now);
  if(now.getHours() >= 5 && now.getHours() < 13) start.setHours(5,30,0,0);
  else if(now.getHours() >= 13 && now.getHours() < 21) start.setHours(13,30,0,0);
  else {
    if(now.getHours() < 5) start.setDate(start.getDate()-1);
    start.setHours(21,30,0,0);
  }
  return start.getTime();
}

/* === Stoppuhr === */
let stopwatchSeconds = 0, stopwatchInterval, stopwatchTimes = [];
function updateStopwatchDisplay(){
  const m = String(Math.floor(stopwatchSeconds/60)).padStart(2,"0");
  const s = String(stopwatchSeconds%60).padStart(2,"0");
  document.getElementById("stopwatch").textContent = `${m}:${s}`;
}
function startStopwatch(){ clearInterval(stopwatchInterval); stopwatchInterval = setInterval(()=>{ stopwatchSeconds++; updateStopwatchDisplay(); },1000); }
function stopStopwatch(){
  clearInterval(stopwatchInterval);
  stopwatchTimes.push(stopwatchSeconds);
  document.getElementById("lastTime").textContent = "Letzte Zeit: " + formatTime(stopwatchSeconds);
  const avg = Math.floor(stopwatchTimes.reduce((a,b)=>a+b,0) / stopwatchTimes.length);
  document.getElementById("avgTime").textContent = "Durchschnitt: " + formatTime(avg);
}
function resetStopwatch(){ clearInterval(stopwatchInterval); stopwatchSeconds=0; updateStopwatchDisplay(); }
function formatTime(sec){ return `${String(Math.floor(sec/60)).padStart(2,"0")}:${String(sec%60).padStart(2,"0")}`; }

/* === PDF Export === */
function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const now = new Date().toLocaleString();
  doc.text("Maschinen-Check Bericht", 10, 10);
  doc.text("Datum: " + now, 10, 20);
  doc.text(document.getElementById("shiftInfo").textContent, 10, 30);
  let y = 40;
  tasks.filter(t=>t.done).forEach(t=>{
    doc.text(`Maschine ${t.nr} - ${t.duration} Min`, 10, y);
    if(t.tags && t.tags.length>0) doc.text("Aufgaben: " + t.tags.join(", "), 10, y+5);
    if(t.note) doc.text("Notiz: " + t.note, 10, y+10);
    y += 20;
  });
  doc.save("Maschinenbericht.pdf");
}

/* === Init === */
detectShift();
setInterval(updatePauseInfo, 10000);
</script>
</body>
</html>
